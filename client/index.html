<!doctype html>
<html lang="en" ng-app>
  <head>
    <title>PayPal Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
 
   
  </head>
  <body>
    <div class="container" ng-controller="ChatController">
      <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
          <div class="pull-right">
            <a href="https://c9.io" class="brand">Demo BT popup-bridge-android</a>
          </div>
        </div>
      </div>
      <div class="page-header">
       
      </div>
      <div class="row">
        <div class="col-lg-3 col-sm-2">
          <img src="https://www.91-img.com/pictures/128557-v5-honor-9n-mobile-phone-large-1.jpg" width="260px" height="300px">
        </div>

        <div class="col-lg-3 col-sm-2" style="margin-left: 70px;margin-top: 30px;margin-bottom: 50px">

          <div id="showCartButton">
            <P>Price :  $30.11 </P>
             <button id="addToCart" class="btn btn-info">Add To cart</button>
          </div>
          <div id="showCart" style="display:none">
              Items in cart : 1
          </div>
          <div id="showPayPalButton" style="display:none ; margin-top: 10px">
              <button id="payWithPaypal" class="btn btn-info">Pay With PayPal</button>
          </div>

          
        </div>

      </div>
     
    </div>
   
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script type="text/javascript">
       function gotopage() {
          window.open("https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=_express-checkout&token=EC-2YF73368JJ2475715");
        }



         function gotopage1() {
          console.log("gotopage1()")
          location.href = "https://www.google.com";
        }

        function gotoPayment(cb){
            var payload = {
             
             }
           $.post( "/create-payments", payload, function( data ) {
              console.log(data)
              for(var i in data.links) {
                if(data.links[i]['method'] == "REDIRECT"){
                  console.log(data.links[i]['href'])
                  cb(data.links[i]['href']);
                  break;
                }
              }
            });
        }

        $( document ).ready(function() {
          console.log( "ready!" );

          $("#addToCart").on('click', function(){
             $("#showCartButton").hide();
             $("#showCart").show();
             $("#showPayPalButton").show();
          })

       
           $("#payWithPaypal").on('click', function(){
              gotoPayment(function(link){
                
             //   console.log(link+ '?popupBridgeReturnUrlPrefix=' + popupBridge.getReturnUrlPrefix())
                if(window.popupBridge) {
                    console.log(link+ '?popupBridgeReturnUrlPrefix=' + popupBridge.getReturnUrlPrefix())
                    popupBridge.open(link+ '?popupBridgeReturnUrlPrefix=' + popupBridge.getReturnUrlPrefix());
                      popupBridge.onComplete = function (err, payload) {
                        
                        if (err) {
                          console.error('PopupBridge onComplete Error:', err);
                        } else if (!err && !payload) {
                          console.log('User closed popup.');
                        } else {
                          console.log('Your payment completed ' + payload.queryItems.status);
                          window.location.href = "/transactionstatus.html?status="+payload.queryItems.status;
                          
                        }
                    };
                }else {
                  window.open(link)
                }
              })
          })
       
        })
    </script>
  
  </body>
</html>
