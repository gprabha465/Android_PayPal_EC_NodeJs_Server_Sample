		<title>PayPal</title>
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta content="utf-8" http-equiv="encoding">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="url" http-equiv="Refresh" content="5; url=myapp://returnApp?status=1">
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
    <link rel="stylesheet" href="/css/font-awesome.css">
    <style>
      body {
        padding-top: 60px;
      }
    </style>
   
  </head>
  <body>
    <div class="container" ng-controller="ChatController">
      <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
          <div class="pull-right">
            <a href="https://c9.io" class="brand">Demo Showcasing PayPal EC v4 </a>
          </div>
        </div>
      </div>
     
      
      <div class="row">
        <div class="col-sm-12 col-sm-offset-4" >
          <h3 id="msgH"></h3>
          <div><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>
          <p>You will be redirected ....</p>
            <a id="proccedButton" class="btn btn-primary">Proceed to App</a>

            <input type="button" class="btn btn-primary" onclick="RedirectSuccess();" name="ok" id="successButton" value="Continue" style="display:none" />
					   </div>
      </div>
     
    </div>
   
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      function qs(key) {
			    key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
			    var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
			    return match && decodeURIComponent(match[1].replace(/\+/g, " "));
			}
      //paypal.test.com.btpopup.popupbridge://popupbridgev1/
      var successUrl = "paypal.test.com.btpopup.popupbridge://popupbridgev1/?status=true";
      var failureUrl = "paypal.test.com.btpopup.popupbridge://popupbridgev1/?status=true"
			
			$( document ).ready(function() {

            var query = qs("status");
            if(query == "true") {
              $("#msgH").text("Transaction success")
              document.querySelector('meta[name="url"]').setAttribute("url", successUrl);

            }else {
               $("#msgH").text("Transaction failed")
               document.querySelector('meta[name="url"]').setAttribute("url", failureUrl);

            }


             $("#proccedButton").on('click', function(){
               $("#successButton").trigger("click");
             })


              setTimeout(function() {
                console.log("successButton fired")
                  $("#successButton").trigger("click");
              }, 1000);


            });
    	

             function RedirectSuccess() {
              
              if (location.search.indexOf('status') !== -1) {
                var prefix = location.search.split('status=')[1];
                // Open the deep link back to the app, and send some data
                if(prefix == "true") {
                  location.href = successUrl;
                }else {
                  location.href = failureUrl;
                }
              } 
          }

	        function RedirectCancel(){
	            window.location=failureUrl;
	        }
        
    </script>
  </body>
</html>
